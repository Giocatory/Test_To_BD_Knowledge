{% extends "base.html" %}

{% block title %}–¢–µ—Å—Ç –ø–æ SQL{% endblock %}

{% block header %}
  <h1>üìù –¢–µ—Å—Ç –ø–æ SQL</h1>
  <p>–í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: 10 –º–∏–Ω—É—Ç</p>
{% endblock %}

{% block extra_head %}
  <meta http-equiv="refresh" content="{{ time_left }};url=/result/{{ test_id }}">
{% endblock %}

{% block content %}
  <div class="timer" id="timer-container">
    ‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <span id="timer">{{ time_left }}</span> —Å–µ–∫—É–Ω–¥
  </div>
  
  <form method="post" action="/submit/{{ test_id }}" id="test-form">
    {% for q in questions %}
      <div class="question">
        <div class="question-number">{{ loop.index }}. {{ q.text }}</div>
        <div class="options">
          {% for opt in q.options %}
            <label>
              <input type="radio" name="{{ q.id }}" value="{{ loop.index }}" required 
                     style="margin-right: 10px; transform: scale(1.2);">
              <span>{{ loop.index }}. {{ opt }}</span>
            </label>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    
    <button type="submit" class="btn btn-block">
      ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
    </button>
  </form>
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let timeLeft = {{ time_left }};
      const timerEl = document.getElementById('timer');
      const timerContainer = document.getElementById('timer-container');
      const form = document.getElementById('test-form');
      
      // –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
      const updateTimerStyle = () => {
        if (timeLeft < 60) {
          timerContainer.style.borderColor = '#e74c3c';
          timerContainer.style.backgroundColor = '#fef6f6';
          timerContainer.style.color = '#e74c3c';
        } else if (timeLeft < 120) {
          timerContainer.style.borderColor = '#f39c12';
          timerContainer.style.backgroundColor = '#fff8e6';
          timerContainer.style.color = '#f39c12';
        }
      };
      
      const countdown = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        updateTimerStyle();
        
        if (timeLeft <= 0) {
          clearInterval(countdown);
          form.requestSubmit(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
        }
      }, 1000);
      
      updateTimerStyle();
    });
  </script>
{% endblock %}